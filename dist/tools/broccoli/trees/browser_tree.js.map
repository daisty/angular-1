{"version":3,"file":"browser_tree.js","sourceRoot":"","sources":["../../../../tools/broccoli/trees/browser_tree.ts"],"names":[],"mappings":"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","sourcesContent":["'use strict';\n\nvar Funnel = require('broccoli-funnel');\nvar htmlReplace = require('../html-replace');\nvar jsReplace = require('../js-replace');\nvar path = require('path');\nvar stew = require('broccoli-stew');\n\nimport compileWithTypescript from '../broccoli-typescript';\nimport destCopy from '../broccoli-dest-copy';\nimport flatten from '../broccoli-flatten';\nimport mergeTrees from '../broccoli-merge-trees';\nimport replace from '../broccoli-replace';\nimport checkImports from '../broccoli-check-imports';\n\n\nconst kServedPaths = [\n  // Relative (to /modules) paths to benchmark directories\n  'benchmarks/src',\n  'benchmarks/src/change_detection',\n  'benchmarks/src/compiler',\n  'benchmarks/src/costs',\n  'benchmarks/src/di',\n  'benchmarks/src/element_injector',\n  'benchmarks/src/largetable',\n  'benchmarks/src/naive_infinite_scroll',\n  'benchmarks/src/page_load',\n  'benchmarks/src/tree',\n  'benchmarks/src/static_tree',\n\n  // Relative (to /modules) paths to external benchmark directories\n  'benchmarks_external/src',\n  'benchmarks_external/src/compiler',\n  'benchmarks_external/src/largetable',\n  'benchmarks_external/src/naive_infinite_scroll',\n  'benchmarks_external/src/tree',\n  'benchmarks_external/src/tree/react',\n  'benchmarks_external/src/static_tree',\n\n  // Relative (to /modules) paths to example directories\n  'playground/src/animate',\n  'playground/src/benchpress',\n  'playground/src/model_driven_forms',\n  'playground/src/template_driven_forms',\n  'playground/src/person_management',\n  'playground/src/order_management',\n  'playground/src/gestures',\n  'playground/src/hash_routing',\n  'playground/src/hello_world',\n  'playground/src/http',\n  'playground/src/jsonp',\n  'playground/src/key_events',\n  'playground/src/relative_assets',\n  'playground/src/routing',\n  'playground/src/sourcemap',\n  'playground/src/svg',\n  'playground/src/todo',\n  'playground/src/upgrade',\n  'playground/src/zippy_component',\n  'playground/src/async',\n  'playground/src/web_workers/kitchen_sink',\n  'playground/src/web_workers/todo',\n  'playground/src/web_workers/images',\n  'playground/src/web_workers/message_broker',\n  'playground/src/web_workers/router',\n  'playground/src/web_workers/input',\n];\n\n\nmodule.exports = function makeBrowserTree(options: any, destinationPath: string) {\n  // TODO: define an interface for the options\n  const modules = options.projects;\n  const noTypeChecks = options.noTypeChecks;\n  const generateEs6 = options.generateEs6;\n  const sourceMaps = options.sourceMaps;\n  const useBundles = options.useBundles;\n\n  if (modules.angular2) {\n    var angular2Tree = new Funnel('modules/angular2', {\n      include: ['**/**'],\n      exclude: [\n        // Exclude ES6 polyfill typings when tsc target=ES6\n        'typings/es6-*/**',\n      ],\n      destDir: '/angular2/'\n    });\n  }\n\n  if (modules.benchmarks) {\n    var benchmarksTree = new Funnel(\n        'modules/benchmarks',\n        {include: ['**/**'], exclude: ['e2e_test/**'], destDir: '/benchmarks/'});\n  }\n\n  if (modules.benchmarks_external) {\n    var benchmarksExternalTree = new Funnel(\n        'modules/benchmarks_external',\n        {include: ['**/**'], exclude: ['e2e_test/**'], destDir: '/benchmarks_external/'});\n  }\n\n  if (modules.payload_tests) {\n    var payloadTestsTree = new Funnel(\n        'modules/payload_tests',\n        {include: ['**/ts/**'], exclude: ['e2e_test/**'], destDir: '/payload_tests/'});\n  }\n\n  if (modules.playground) {\n    var playgroundTree = new Funnel(\n        'modules/playground',\n        {include: ['**/**'], exclude: ['e2e_test/**'], destDir: '/playground/'});\n  }\n\n  if (modules.benchpress) {\n    var benchpressTree = new Funnel(\n        'modules/benchpress',\n        {include: ['**/**'], exclude: ['e2e_test/**'], destDir: '/benchpress/'});\n  }\n\n  let externalTypings =\n      new Funnel('node_modules', {include: ['rxjs/**/*.d.ts', 'zone.js/**/*.d.ts']});\n\n\n  var modulesTree = mergeTrees([\n    angular2Tree,\n    benchmarksTree,\n    benchmarksExternalTree,\n    payloadTestsTree,\n    playgroundTree,\n    benchpressTree,\n    externalTypings,\n  ]);\n\n  var es6PolyfillTypings =\n      new Funnel('modules', {include: ['angular2/typings/es6-*/**'], destDir: '/'});\n\n  var es5ModulesTree = mergeTrees([modulesTree, es6PolyfillTypings]);\n\n  var scriptPathPatternReplacement = {\n    match: '@@PATH',\n    replacement: function(replacement: string, relativePath: string) {\n      var parts = relativePath.replace(/\\\\/g, '/').split('/');\n      return parts.splice(0, parts.length - 1).join('/');\n    }\n  };\n\n  var scriptFilePatternReplacement = {\n    match: '@@FILENAME',\n    replacement: function(replacement: string, relativePath: string) {\n      var parts = relativePath.replace(/\\\\/g, '/').split('/');\n      return parts[parts.length - 1].replace('html', 'js');\n    }\n  };\n\n  var useBundlesPatternReplacement = {\n    match: '@@USE_BUNDLES',\n    replacement: function(replacement: string, relativePath: string) { return useBundles; }\n  };\n\n  // Check that imports do not break barrel boundaries\n  modulesTree = checkImports(modulesTree);\n\n  modulesTree = replace(modulesTree, {\n    files: ['playground*/**/*.js'],\n    patterns: [{match: /\\$SCRIPTS\\$/, replacement: jsReplace('SCRIPTS')}]\n  });\n\n  let ambientTypings = [\n    'angular2/typings/hammerjs/hammerjs.d.ts',\n    'angular2/typings/node/node.d.ts',\n    'node_modules/zone.js/dist/zone.js.d.ts',\n    'angular2/manual_typings/globals.d.ts',\n    'angular2/typings/es6-collections/es6-collections.d.ts',\n    'angular2/typings/es6-promise/es6-promise.d.ts',\n  ];\n\n  // Use TypeScript to transpile the *.ts files to ES5\n  var es5Tree = compileWithTypescript(es5ModulesTree, {\n    declaration: false,\n    emitDecoratorMetadata: true,\n    experimentalDecorators: true,\n    module: 'commonjs',\n    moduleResolution: 'classic',\n    noEmitOnError: !noTypeChecks,\n    rootDir: './',\n    rootFilePaths: ambientTypings,\n    inlineSourceMap: sourceMaps,\n    inlineSources: sourceMaps,\n    target: 'es5'\n  });\n\n  var vendorScriptsTree = flatten(new Funnel('.', {\n    files: [\n      'node_modules/es6-shim/es6-shim.js',\n      'node_modules/zone.js/dist/zone.js',\n      'node_modules/zone.js/dist/long-stack-trace-zone.js',\n      'node_modules/systemjs/dist/system.src.js',\n      'node_modules/base64-js/lib/b64.js',\n      'node_modules/reflect-metadata/Reflect.js',\n    ]\n  }));\n\n  var vendorScripts_benchmark =\n      new Funnel('tools/build/snippets', {files: ['url_params_to_form.js'], destDir: '/'});\n  var vendorScripts_benchmarks_external =\n      new Funnel('node_modules/angular', {files: ['angular.js'], destDir: '/'});\n\n  // Get scripts for each benchmark or example\n  let servingTrees = kServedPaths.reduce(getServedFunnels, []);\n  function getServedFunnels(funnels: BroccoliTree[], destDir: string) {\n    let options = {srcDir: '/', destDir: destDir};\n    funnels.push(new Funnel(vendorScriptsTree, options));\n    if (destDir.indexOf('benchmarks') > -1) {\n      funnels.push(new Funnel(vendorScripts_benchmark, options));\n    }\n    if (destDir.indexOf('benchmarks_external') > -1) {\n      funnels.push(new Funnel(vendorScripts_benchmarks_external, options));\n    }\n    return funnels;\n  }\n\n\n  if (modules.benchmarks || modules.benchmarks_external || modules.playground) {\n    var assetsTree = new Funnel(\n        modulesTree, {include: ['**/*'], exclude: ['**/*.{html,ts,dart}'], destDir: '/'});\n  }\n\n  var htmlTree = new Funnel(modulesTree, {\n    include: ['*/src/**/*.html', '**/playground/**/*.html', '**/payload_tests/**/ts/**/*.html'],\n    destDir: '/'\n  });\n\n  if (modules.playground) {\n    htmlTree = replace(htmlTree, {\n      files: ['playground*/**/*.html'],\n      patterns: [\n        {match: /\\$SCRIPTS\\$/, replacement: htmlReplace('SCRIPTS')}, scriptPathPatternReplacement,\n        scriptFilePatternReplacement, useBundlesPatternReplacement\n      ]\n    });\n  }\n\n  if (modules.benchmarks) {\n    htmlTree = replace(htmlTree, {\n      files: ['benchmarks/**'],\n      patterns: [\n        {match: /\\$SCRIPTS\\$/, replacement: htmlReplace('SCRIPTS_benchmarks')},\n        scriptPathPatternReplacement, scriptFilePatternReplacement, useBundlesPatternReplacement\n      ]\n    });\n  }\n\n  if (modules.benchmarks_external) {\n    htmlTree = replace(htmlTree, {\n      files: ['benchmarks_external/**'],\n      patterns: [\n        {match: /\\$SCRIPTS\\$/, replacement: htmlReplace('SCRIPTS_benchmarks_external')},\n        scriptPathPatternReplacement, scriptFilePatternReplacement, useBundlesPatternReplacement\n      ]\n    });\n  }\n\n  if (modules.playground) {\n    // We need to replace the regular angular bundle with the web-worker bundle\n    // for web-worker e2e tests.\n    htmlTree = replace(htmlTree, {\n      files: ['playground*/**/web_workers/**/*.html'],\n      patterns: [{match: '/bundle/angular2.dev.js', replacement: '/bundle/web_worker/ui.dev.js'}]\n    });\n  }\n\n  if (modules.benchmarks || modules.benchmarks_external) {\n    var scripts = mergeTrees(servingTrees);\n  }\n\n  if (modules.benchmarks_external) {\n    var polymerFiles = new Funnel('.', {\n      files: [\n        'bower_components/polymer/polymer.html',\n        'bower_components/polymer/polymer-micro.html',\n        'bower_components/polymer/polymer-mini.html',\n        'tools/build/snippets/url_params_to_form.js',\n      ]\n    });\n    var polymer = stew.mv(flatten(polymerFiles), 'benchmarks_external/src/tree/polymer');\n\n    var reactFiles = new Funnel('.', {files: ['node_modules/react/dist/react.min.js']});\n    var react = stew.mv(flatten(reactFiles), 'benchmarks_external/src/tree/react');\n  }\n\n  if (modules.benchmarks || modules.benchmarks_external || modules.playground) {\n    htmlTree = mergeTrees([htmlTree, scripts, polymer, react]);\n  }\n\n  // this is needed only for creating a bundle\n  // typescript resolves dependencies automatically\n  if (modules.bundle_deps) {\n    var nodeModules = new Funnel(\n        'node_modules', {include: ['rxjs/**/**', 'parse5/**/**', 'css/**/**'], destDir: '/'});\n  }\n\n  if (generateEs6) {\n    // Use TypeScript to transpile the *.ts files to ES6\n    var es6Tree = compileWithTypescript(modulesTree, {\n      declaration: false,\n      emitDecoratorMetadata: true,\n      experimentalDecorators: true,\n      noEmitOnError: false,\n      rootDir: './',\n      rootFilePaths: [\n        'angular2/typings/zone.js/zone.js.d.ts',\n        'angular2/typings/hammerjs/hammerjs.d.ts',\n        'angular2/typings/node/node.d.ts',\n      ],\n      inlineSourceMap: sourceMaps,\n      inlineSources: sourceMaps,\n      target: 'es6'\n    });\n\n    es6Tree = stew.mv(mergeTrees([es6Tree, htmlTree, assetsTree, nodeModules]), '/es6');\n  }\n  es5Tree = stew.mv(mergeTrees([es5Tree, htmlTree, assetsTree, nodeModules]), '/es5');\n\n  var mergedTree = mergeTrees([es6Tree, es5Tree]);\n  return destCopy(mergedTree, destinationPath);\n};\n"]}