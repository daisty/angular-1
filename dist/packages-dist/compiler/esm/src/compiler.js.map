{"version":3,"file":"compiler.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/src/compiler.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {Compiler, CompilerFactory, CompilerOptions, Component, ComponentResolver, Injectable, NgModule, PLATFORM_DIRECTIVES, PLATFORM_PIPES, PlatformRef, ReflectiveInjector, Type, ViewEncapsulation, createPlatformFactory, disposePlatform, isDevMode} from '@angular/core';\n\nexport * from './template_ast';\nexport {TEMPLATE_TRANSFORMS} from './template_parser';\nexport {CompilerConfig, RenderTypes} from './config';\nexport * from './compile_metadata';\nexport * from './offline_compiler';\nexport {RuntimeCompiler} from './runtime_compiler';\nexport * from './url_resolver';\nexport * from './xhr';\n\nexport {ViewResolver} from './view_resolver';\nexport {DirectiveResolver} from './directive_resolver';\nexport {PipeResolver} from './pipe_resolver';\nexport {NgModuleResolver} from './ng_module_resolver';\n\nimport {stringify} from './facade/lang';\nimport {ListWrapper} from './facade/collection';\nimport {TemplateParser} from './template_parser';\nimport {HtmlParser} from './html_parser';\nimport {DirectiveNormalizer} from './directive_normalizer';\nimport {CompileMetadataResolver} from './metadata_resolver';\nimport {StyleCompiler} from './style_compiler';\nimport {ViewCompiler} from './view_compiler/view_compiler';\nimport {NgModuleCompiler} from './ng_module_compiler';\nimport {CompilerConfig} from './config';\nimport {RuntimeCompiler} from './runtime_compiler';\nimport {ElementSchemaRegistry} from './schema/element_schema_registry';\nimport {DomElementSchemaRegistry} from './schema/dom_element_schema_registry';\nimport {UrlResolver, DEFAULT_PACKAGE_URL_PROVIDER} from './url_resolver';\nimport {Parser} from './expression_parser/parser';\nimport {Lexer} from './expression_parser/lexer';\nimport {ViewResolver} from './view_resolver';\nimport {DirectiveResolver} from './directive_resolver';\nimport {PipeResolver} from './pipe_resolver';\nimport {NgModuleResolver} from './ng_module_resolver';\nimport {Console, Reflector, reflector, ReflectorReader} from '../core_private';\nimport {XHR} from './xhr';\n\n/**\n * A set of providers that provide `RuntimeCompiler` and its dependencies to use for\n * template compilation.\n */\nexport const COMPILER_PROVIDERS: Array<any|Type|{[k: string]: any}|any[]> =\n    /*@ts2dart_const*/[\n      {provide: Reflector, useValue: reflector},\n      {provide: ReflectorReader, useExisting: Reflector},\n      Console,\n      Lexer,\n      Parser,\n      HtmlParser,\n      TemplateParser,\n      DirectiveNormalizer,\n      CompileMetadataResolver,\n      DEFAULT_PACKAGE_URL_PROVIDER,\n      StyleCompiler,\n      ViewCompiler,\n      NgModuleCompiler,\n      /*@ts2dart_Provider*/ {provide: CompilerConfig, useValue: new CompilerConfig()},\n      RuntimeCompiler,\n      /*@ts2dart_Provider*/ {provide: ComponentResolver, useExisting: RuntimeCompiler},\n      /*@ts2dart_Provider*/ {provide: Compiler, useExisting: RuntimeCompiler},\n      DomElementSchemaRegistry,\n      /*@ts2dart_Provider*/ {provide: ElementSchemaRegistry, useExisting: DomElementSchemaRegistry},\n      UrlResolver,\n      ViewResolver,\n      DirectiveResolver,\n      PipeResolver,\n      NgModuleResolver\n    ];\n\n\nexport function analyzeAppProvidersForDeprecatedConfiguration(appProviders: any[] = []):\n    {compilerOptions: CompilerOptions, moduleDeclarations: Type[], deprecationMessages: string[]} {\n  let platformDirectives: any[] = [];\n  let platformPipes: any[] = [];\n\n  let compilerProviders: any[] = [];\n  let useDebug: boolean;\n  let useJit: boolean;\n  let defaultEncapsulation: ViewEncapsulation;\n  const deprecationMessages: string[] = [];\n\n  // Note: This is a hack to still support the old way\n  // of configuring platform directives / pipes and the compiler xhr.\n  // This will soon be deprecated!\n  const tempInj = ReflectiveInjector.resolveAndCreate(appProviders);\n  const compilerConfig: CompilerConfig = tempInj.get(CompilerConfig, null);\n  if (compilerConfig) {\n    platformDirectives = compilerConfig.platformDirectives;\n    platformPipes = compilerConfig.platformPipes;\n    useJit = compilerConfig.useJit;\n    useDebug = compilerConfig.genDebugInfo;\n    defaultEncapsulation = compilerConfig.defaultEncapsulation;\n    deprecationMessages.push(\n        `Passing CompilerConfig as a regular provider is deprecated. Use the \"compilerOptions\" parameter of \"bootstrap()\" or use a custom \"CompilerFactory\" platform provider instead.`);\n  } else {\n    // If nobody provided a CompilerConfig, use the\n    // PLATFORM_DIRECTIVES / PLATFORM_PIPES values directly if existing\n    platformDirectives = tempInj.get(PLATFORM_DIRECTIVES, []);\n    platformPipes = tempInj.get(PLATFORM_PIPES, []);\n  }\n  platformDirectives = ListWrapper.flatten(platformDirectives);\n  platformPipes = ListWrapper.flatten(platformPipes);\n  const xhr = tempInj.get(XHR, null);\n  if (xhr) {\n    compilerProviders.push([{provide: XHR, useValue: xhr}]);\n    deprecationMessages.push(\n        `Passing XHR as regular provider is deprecated. Pass the provider via \"compilerOptions\" instead.`);\n  }\n\n  if (platformDirectives.length > 0) {\n    deprecationMessages.push(\n        `The PLATFORM_DIRECTIVES provider and CompilerConfig.platformDirectives is deprecated. Add the directives to an NgModule instead! ` +\n        `(Directives: ${platformDirectives.map(type => stringify(type))})`);\n  }\n  if (platformPipes.length > 0) {\n    deprecationMessages.push(\n        `The PLATFORM_PIPES provider and CompilerConfig.platformPipes is deprecated. Add the pipes to an NgModule instead! ` +\n        `(Pipes: ${platformPipes.map(type => stringify(type))})`);\n  }\n  const compilerOptions: CompilerOptions = {\n    useJit: useJit,\n    useDebug: useDebug,\n    defaultEncapsulation: defaultEncapsulation,\n    providers: compilerProviders\n  };\n  class DynamicComponent {\n  /** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Component, args: [{directives: platformDirectives, pipes: platformPipes, template: ''}, ] },\n];\n}\n\n  return {\n    compilerOptions,\n    moduleDeclarations: [DynamicComponent],\n    deprecationMessages: deprecationMessages\n  };\n}\nexport class _RuntimeCompilerFactory extends CompilerFactory {\n  createCompiler(options: CompilerOptions): Compiler {\n    const injector = ReflectiveInjector.resolveAndCreate([\n      COMPILER_PROVIDERS, {\n        provide: CompilerConfig,\n        useFactory: () => {\n          return new CompilerConfig({\n            // let explicit values from the compiler options overwrite options\n            // from the app providers. E.g. important for the testing platform.\n            genDebugInfo: _firstDefined(options.useDebug, isDevMode()),\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            useJit: _firstDefined(options.useJit, true),\n            // let explicit values from the compiler options overwrite options\n            // from the app providers\n            defaultEncapsulation:\n                _firstDefined(options.defaultEncapsulation, ViewEncapsulation.Emulated),\n            logBindingUpdate: _firstDefined(options.useDebug, isDevMode())\n          });\n        },\n        deps: []\n      },\n      // options.providers will always contain a provider for XHR as well\n      // (added by platforms). So allow compilerProviders to overwrite this\n      options.providers ? options.providers : []\n    ]);\n    return injector.get(Compiler);\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n}\n\n\nexport const RUNTIME_COMPILER_FACTORY = new _RuntimeCompilerFactory();\n\nfunction _firstDefined<T>(...args: T[]): T {\n  for (var i = 0; i < args.length; i++) {\n    if (args[i] !== undefined) {\n      return args[i];\n    }\n  }\n  return undefined;\n}\n\nfunction _mergeArrays(...parts: any[][]): any[] {\n  let result: any[] = [];\n  parts.forEach((part) => result.push(...part));\n  return result;\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}